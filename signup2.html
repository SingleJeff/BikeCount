<html>

<head>
<link rel="shortcut icon" href="https://ssl.gstatic.com/docs/spreadsheets/forms/favicon_jfk2.png" type="image/x-icon"/>
<meta http-equiv="Content-type" content="text/html; charset=UTF-8">
<title>2016 Tempe Bike Count Volunteer Sign-Up</title>
<link href="signupformgoogle_files/779923916-published_form_compiled.css" type="text/css" rel="stylesheet"/>
<!-- <script type="text/javascript" src='jquery.min.js'></script> -->
<script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<!-- <script type="text/javascript" src="ua-parser.min.js"></script> let's try without it; it doesn't seem to give a clear mobile/non-mobile indication anyway -->
<!-- <script type="text/javascript" src="openlayers/lib/OpenLayers.js"></script> -->
<script type="text/javascript" src='http://openlayers.org/api/OpenLayers.js'></script>
</head>

<body class="ss-base-body" dir="ltr" itemscope="" itemtype="http://schema.org/CreativeWork/FormObject" onload="draw_map();">

<div class="ss-form-container">
<div class="ss-form-heading"><h1 class="ss-form-title">2016 Tempe Bike Count Volunteer Sign-Up</h1>
<p></p>
<div class="ss-form-desc ss-no-ignore-whitespace">
Thank you for volunteering for the Tempe Bike Count.

There are six possible shifts: AM and PM shifts on March 29, 30, and 31.

The AM shifts are 7am to 9am.  The PM shifts are 4pm to 6pm.

Read more about the event at <a href="http://www.biketempe.org/events/bike-count/">http://www.biketempe.org/events/bike-count/</a>.

Info collected is for use at this event only, and to alert you when the very next Bike Count comes around.  If we can't reach you by email to confirm your count time and location, we will assign your intersection to someone else.

Sign up for TBAG email at <a href="http://biketempe.org">biketempe.org</a> to hear about events, volunteer opertunities, or projects.

Contact <a href="mailto:bikecount@biketempe.org">bikecount@biketempe.org</a> for help, to remove a shift, etc.

<a href="/bikecount/unassigned_locations.txt" target="_blank">Here are the AM (xxxA) and PM (xxxP) locations that are still open</a>.
<!--
<b>Update:</b> Both training dates are past and shift confirmations have been mailed out.
If you sign up past this point, you need to coordinate directly with Scott at the email address
above.
  -->
</div>

<hr class="ss-email-break" style="display: none;">
<br>
<div class="ss-required-asterisk">* RequiredERROR</div></div>
<br>
<div class="ss-form">

<form method="POST" id="ss-form">

<script type="text/javascript">

function view_current_assignments() {
    $.ajax({
        type: "GET",
        url: "?action=get_assignments&email=" + encodeURIComponent($('#email_address').val())
    }).done(function( html ) {
        $('#current_assignments').html(html);
        $('#current_assignments_popup').html(html);
        $('#assignments').css('display', 'block');
    });
}

</script>

<div class="errorbox-good">
    <div class="ss-item ss-item-required ss-text">
        <div class="ss-form-entry"><label class="ss-q-title" for="email_address">Email Address
            <span class="ss-required-asterisk">*</span></label>
            <label class="ss-q-help" for="email_address"></label>
            <input name="email_address" class="ss-q-short input_element" id="email_address" type="text" onload="this.focus()">
            <input type="button" value="<-- View Your Current Assignment(s)" onclick="view_current_assignments()">

        </div>
    </div>
</div>

<div id="assignments" style="display:none; background:#FFF; border:solid 1px #BBBBBB; border-radius:5px; box-shadow:0px 0px 15px #999; ">
    <div class='arrow'></div>
    <div class='arrow-border'></div>
    <div id="current_assignments_popup">Loading...</div>
    <input value="Okay" type="button" onclick="document.getElementById('assignments').style.display = 'none';">
</div>

<div class="errorbox-good">
    <div class="ss-item ss-item-required ss-text">
        <div class="ss-form-entry">
            <label class="ss-q-title" for="first_name">First Name <span class="ss-required-asterisk">*</span></label>
            <label class="ss-q-help" for="first_name"></label>
            <input name="first_name" class="ss-q-short input_element" id="first_name" type="text">
        </div>
    </div>
</div>


<div class="errorbox-good">
<div class="ss-item ss-item-required ss-text"><div class="ss-form-entry"><label class="ss-q-title" for="last_name">Last Name
<span class="ss-required-asterisk">*</span></label>
<label class="ss-q-help" for="last_name"></label>
<input name="last_name" class="ss-q-short input_element" id="last_name" type="text"></div></div></div>


<div class="errorbox-good">
<div class="ss-item ss-item-required ss-text"><div class="ss-form-entry"><label class="ss-q-title" for="phone_number">Phone Number
<span class="ss-required-asterisk">*</span></label>
<label class="ss-q-help" for="phone_number"></label>
<input name="phone_number" class="ss-q-short input_element" id="phone_number" type="text"></div></div></div>

<!-- early reg quiz -->

<div class="errorbox-good">
<div class="ss-item ss-item-required ss-radio"><div class="ss-form-entry"><label class="ss-q-title" for="entry_7">Bike Count Training Session
<span class="ss-required-asterisk">*</span></label>
<label class="ss-q-help" for="entry_7">All volunteers must attend one 60 minute training rally at the 
Tempe Transportation Center (<a href="https://www.google.com/maps/place/Veterans+Way%2FCollege+Light+Rail+Station/@33.425972,-111.935242,15z/data=!4m2!3m1!1s0x872b08d8ba257f97:0xa164c2ceefaecd7" target="_blank">map</a>).
Pizza will be provided. 
Please indicate which date you plan to attend.
</label>
<ul class="ss-choices">
<li class="ss-choice-item"><label class="ss-choice-label"><input name="training_session" value="Thu 3/24" class="ss-q-radio" type="radio">Thu 3/24, 6:00pm</label></li>
<li class="ss-choice-item"><label class="ss-choice-label"><input name="training_session" value="Sat 3/26" class="ss-q-radio" type="radio">Sat 3/26, 3:00pm</label></li>
<li class="ss-choice-item"><input name="training_session" value="Other" class="ss-q-radio" id="other_option:7" type="radio"><label for="other_option:7">Other/None (explain):</label>
<input name="training_session_comment" class="ss-q-other" type="text">
</li></ul>
</div></div></div>

<div class="errorbox-good">
    <div class="ss-item ss-item-required ss-text">
        <div class="ss-form-entry">
            <label class="ss-q-title" for="comments">Comments</label>
            <label class="ss-q-help" for="comments">Anything you want the organizers to know?</label>
            <textarea name="comments" cols="50" rows="6" class="ss-q-short" id="comments">COMMENTS</textarea>
        </div>
    </div>
</div>


<div>
    <input type="hidden" name="action" id="action" value="register">
    <!-- <input type="hidden" name="shift" id="shift_input"> -->
    <input name="location_id" class="ss-q-other" id="location_id" type="hidden">

<!-- OSM map -->

<div class="errorbox-good">
    <div class="ss-q-title">Your Current Assignment(s)</div>
    <div class="ss-item ss-item-required ss-text">
        <div class="ss-form-entry">
            <div id="current_assignments">CURRENT_ASSIGNMENTS</div>
        </div>
    </div>
</div>

<div id="enter_your_email" style="display:none; background:#FFF;  border:solid 1px #BBBBBB; border-radius:5px; box-shadow:0px 0px 15px #999;">
    Please first enter your email address above.
    <input type="button" value="OK" onclick="javascript: $('#enter_your_email').hide()">
</div>

<div id="assignment_details" style="display:none; background:#FFF; border:solid 1px #BBBBBB; border-radius:5px; box-shadow:0px 0px 15px #999;">

    <div id="intersection_name" class="ss-q-title"></div>

    <div class="ss-item ss-item-required ss-radio"><div class="ss-form-entry">
    <label class="ss-q-title" for="shift">Bike Count Shift</label>
    <ul class="ss-choices" id="intersection_options">
    <!--
        these options load over the 'net
      -->
    </ul>
    </div></div>

    <div class="ss-item ss-navigate"><div class="ss-form-entry">
        <input name="continue" value="Add Assignment" type="button" onclick=" $('#ss-form').submit();"> <!-- XXX detect and warn user about failure! -->
    </div></div>

</div>

<div>
    <div class="ss-q-title">Click Widget To See Intersection Availability MAPNOTE</div>
    <div class="ss-form-desc ss-no-ignore-whitespace">Count dates are Tues March 29, Wed March 30, and Thurs March 31.
    </div>
</div>

<div id="map" style=" width: 512px; height: 256px; border: 1px solid #ccc; "></div>

<script type="text/javascript">

function draw_map() {

    var mobile = (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));

    var pois = POIS;

    var map = new OpenLayers.Map("map");

    var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
    // var toProjection   = map.getProjectionObject(); // new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection ... that works for positioning hte map but breaks positioning the markers
    var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection

    var osm = new OpenLayers.Layer.OSM("OSM Layer", [
        "http://a.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png",
        "http://b.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png",
        "http://c.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png"
    ]);
    map.addLayer(osm);   // addLayer on a scalar, addLayers on an array

    var markers = new OpenLayers.Layer.Markers( "Markers" );
    map.addLayer(markers);

    for( var i=0; i < pois.length; i++ ) {
 
        var lonLat = new OpenLayers.LonLat( pois[i].lon, pois[i].lat ).transform( fromProjection, toProjection );
        var new_marker = new OpenLayers.Marker(lonLat);

        (function() {
            var desc = pois[i].desc;
            var marker_selected = function (ob) {
                if( ! document.getElementById('email_address').value ) {
                    // no email addresss; show an error message
                    document.getElementById('enter_your_email').style.display = 'block';
                } else {

                    // populate the form with the location_id of the selected intersection, and display the name of it to the human
                    document.getElementById('location_id').value = desc;
                    document.getElementById('intersection_name').innerHTML = desc;

                    $('#map_alternative').val( desc ); // select the same thing on the back-up select list below

                    // fetch the part of the form that lists what days the user wouldn't have conflicts for counting that intersection


                    $.ajax({
                        type: "GET",
                        url: "?action=get_times_for_intersection&location_id=" + desc + "&email=" + encodeURIComponent(document.getElementById('email_address').value)
                    }).done(function( html ) {
                        document.getElementById('intersection_options').innerHTML = html;
                        document.getElementById('assignment_details').style.display = 'block';

                        // scroll to the form

                        var viewportHeight = $(window).height(), 
                            targ = $('#assignment_details'),
                            elHeight = targ.height(),
                            elOffset = targ.offset();
// console.log(targ);
// console.log(elOffset);
// console.log("viewportHeight " + viewportHeight + " elHeight " + elHeight);
                        // $(window).scrollTop( elOffset.top + ( elHeight/2) - (viewportHeight/2));
                        $(window).scrollTop( elOffset.top );

                    });

                } 
            };
            // http://stackoverflow.com/questions/16772597/openlayers-how-to-add-click-and-touch-event-on-markers
            if(mobile) {
                new_marker.events.register( 'touchstart', new_marker, marker_selected );
            } else {
                new_marker.events.register( 'mousedown', new_marker, marker_selected );
            }
        })();
        markers.addMarker(new_marker);

    }

    // from http://opencyclemap.org/?zoom=12&lat=33.39199&lon=-111.93891&layers=B00
    var position = new OpenLayers.LonLat(-111.93891, 33.39199).transform( fromProjection, toProjection);
    var zoom = 12;
    map.setCenter( position, zoom );
}

</script>

<p>
    <select name="map_alternative" id="map_alternative">
        AVAILABLEINTERSECTIONS
    </select>
</p>

<script type="text/javascript">

    $('#map_alternative').change(function() {
        var desc = $('#map_alternative').val();
        document.getElementById('location_id').value = desc;
        document.getElementById('intersection_name').innerHTML = desc;
        $.ajax({
            type: "GET",
            url: "?action=get_times_for_intersection&location_id=" + encodeURIComponent(desc) + "&email=" + encodeURIComponent(document.getElementById('email_address'))
        }).done(function( html ) {
            document.getElementById('assignment_details').style.display = 'block';
            document.getElementById('intersection_options').innerHTML = html;
        });
    });

</script>

<!-- /OSM map -->

</form>

<script type="text/javascript">
      
      (function() {
var divs = document.getElementById('ss-form').
getElementsByTagName('div');
var numDivs = divs.length;
for (var j = 0; j < numDivs; j++) {
if (divs[j].className == 'errorbox-bad') {
divs[j].lastChild.firstChild.lastChild.focus();
return;
}
}
// for (var i = 0; i < numDivs; i++) {
//     var div = divs[i];
//     if (div.className == 'ss-form-entry' &&
//         div.firstChild &&
//         div.firstChild.className == 'ss-q-title') {
//         div.lastChild.focus();
//         return;
//     }
// }
})();
      </script>
</div>
</div></div></body></html>

